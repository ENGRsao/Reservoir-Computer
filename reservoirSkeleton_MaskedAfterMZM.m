clc;
close all;
clear;
%% Load Dataset
filename = 'NARMA10_output.csv';
output = csvread(filename);
input_filename = 'NARMA10_input.csv';
input = csvread(input_filename);
%% Simulation parameters
fft_point = 256;   %FFT points
time_span = 32;     %Time period of the desire signal
delta_tau = (2*time_span)/fft_point;  % smallest division of time
tau = (-fft_point/2:fft_point/2-1)*delta_tau; %time duration spread out of the signal
omega = [(0:fft_point/2-1) (-fft_point/2:-1)] .*(pi/time_span);
normalize_omega = fftshift(omega)/(2*pi); %frequency
T_FWHM = 12.5; %ps
T_nat = T_FWHM/1.655; %Input signal Pulse width in ps; for sech => T_nat = T_FWHM/1.763;
Normalize_tau = tau/T_nat;
guassian_order = 3;
chirp = 0;

% Dispersion parameters
%Beta = 
dispersion_constant = 20; % ps^2/Km
dispersion_length = T_nat^2 / abs(dispersion_constant); %Km
fiber_length = 0.8 * dispersion_length;  %Km

% NonLinear Parameters 
gamma = 1.317; %W^-1.km^-1
alpha = 0.2; %fiber loss db/km
L_effective = (1 - exp(-1 * alpha * fiber_length))/alpha; %Km
Peak_power = 0.50208; %in Watt
NonLinear_length = 1 / (gamma * Peak_power);   %Km
soliton_order  = round(sqrt(dispersion_length/NonLinear_length));  %constant

%% Input signal
u_t = sech(Normalize_tau) .* exp(-1i*0.5*chirp.*Normalize_tau.^2); %sech signal
u_t_guassian = exp(-0.5 * (1+1i*chirp) .* Normalize_tau.^2);  %define guassian pulse


%% Reservoir Network application to NARMA10 task 
input_mask = [0.689435100924171	0.0504550031686729	0.184434115699354	0.0456583234773829	0.885041502041251	0.839794385798114	0.118155245153682	0.410414853697837	0.120228589990650	0.572092522260723	0.949390134629152	0.256385159796880	0.989865435151316	0.349808041044371	0.208522373893430	0.665827160044803	0.973344706720870	0.622699821538518	0.0635378925573686	0.373509533241305	0.166251535436548	0.231278078105778	0.0522086332938522	0.901756316713514	0.793291699901326	0.373014324844645	0.832054705376542	0.753834556589773	0.621863097261786	0.394093180849151	0.359277961450212	0.0888524608922825	0.341677003639647	0.548670594067366	0.460547461088786	0.645452373435590	0.513520841267514	0.814426468563278	0.0971832059869966	0.463713560645511	0.589817489604743	0.187172070539839	0.611330146637952	0.0519419813683460	0.575726948453721	0.842344701828773	0.499725973621345	0.439024887659214	0.149057083245688	0.0282794508957929	0.756669787984348	0.796106235942840	0.293555594417440	0.115206746018031	0.375091630987986	0.828893745056770	0.841776581954761	0.665238451557799	0.960139975886254	0.943117892210703	0.112699492380728	0.648287449225586	0.480804051679440	0.0665206919491224	0.897771225532002	0.497230128936991	0.771303428858631	0.0603622294239692	0.262457464904029	0.651069368702479	0.133603910449774	0.638545736824786	0.384943094967874	0.765698125674700	0.652915682156136	0.381489065282516	0.300018582740438	0.340139555506767	0.918926536712417	0.456266813303239	0.442496952598123	0.454185819615522	0.945282009186640	0.219118952550175	0.882402795931734	0.0198754228247094	0.341764883237310	0.766027445694415	0.342803701519393	0.618806404154405	0.453021162091896	0.0101626026279142	0.599081167470487	0.601568348358472	0.649417450961366	0.342720632582221	0.493299255574885	0.701773945253530	0.887802601429490	0.0550578461561846	0.0983619505457304	0.649782785472762	0.764070891236327	0.987958941597841	0.125324791415593	0.364477175202600	0.676230090282253	0.375758171217492	0.863458491467109	0.291976750986030	0.133474990584297	0.672650514427429	0.202584980871927	0.868515198201092	0.751157321899609	0.419379649992969	0.000231065199416736	0.149463732367703	0.273834301544268	0.872425018962880	0.601251143911812	0.321188452831265	0.284293074456312	0.435315805784207	0.903759051181981	0.925105644987009	0.505292452205831	0.627581809270030	0.719263926822411	0.0239128813596552	0.574932501996900	0.0465344640640383	0.422531388268483	0.467734261291993	0.0226279867559067	0.0650740424646463	0.923956335725144	0.534142863944270	0.366796468997375	0.363946179540744	0.151373665826451	0.149608598632666	0.350802091637144	0.335966095668561	0.784027846268716	0.486739211626018	0.464798012873766	0.131252551596790	0.886391470888295	0.674557425628767	0.835159638023036	0.656487934875432	0.983916976496475	0.979789871891285	0.250153013597979	0.624570703542190	0.728242423153538	0.498170315267308	0.849828294959274	0.190918203621887	0.124143787222168	0.00279042132911189	0.152952789981843	0.534160824643418	0.510633605136478	0.385215879879770	0.310596453716413	0.00355544745321035	0.815242445313671	0.638418458166358	0.448339380701920	0.244085770261907	0.803385085996905	0.823970887228072	0.852190649398636	0.467251755433503	0.970698973176120	0.841244015022289	0.0785482063545127	0.237598887672087	0.817570881268703	0.405828714806259	0.466312220637624	0.951536218081585	0.965005305843558	0.765284866775821	0.574533590173997	0.915925025450222	0.495432408790360	0.166012377080293	0.325997669971674	0.296436106009726	0.558298491530906	0.0674768030510901	0.0689778462108583	0.166784582313363	0.947438262628722	0.811088417621082	0.710455692980488	0.970245561677518	0.998426789341871	0.987454806749042	0.150086578018891	0.958478804453122	0.530459049234420	0.0740865173899161	0.311820903915726	0.895170779995607	0.834768311582722	0.00234875567974879	0.640209846164910	0.803182575087435	0.245130755184197	0.0641222317658926	0.263148319353776	0.102720361262892	0.483719024833911	0.418884462651220	0.381289008027337	0.886765115012407	0.420557514837392	0.283847869017151	0.0481811440107028	0.219165982554382	0.239176014086980	0.0292584870372300	0.702310918358637	0.00763555477239597	0.610920680279354	0.408089537451172	0.248946674813356	0.652459724145901	0.320277088369962	0.103672124495835	0.535564894512648	0.164870242477034	0.883438702353724	0.666457012048093	0.847742491914359	0.762661063721127	0.807013774619851	0.632952443655251	0.710427307863708	0.688663539117781	0.320947861137131	0.531648494500774	0.873193957609839	0.0545396739097971	0.500400775515181	0.432763214528361	0.904282491633212	0.630183351426678	0.983036222076956	0.585200339522547	0.840636517595249	0.468813780579663];

%% Reservoir Network 
    len = fft_point;  
    u_n = (input(1:500))';
    Y_n = (output(1:500))';
    y_n = zeros(1,length(u_n));
    No_of_recurrent = length(u_n);
    result = zeros(No_of_recurrent,len);
    result2 = zeros(No_of_recurrent,len);
    readout_mask = zeros(No_of_recurrent,len);
    
   signal = u_n(1) .* u_t_guassian;  %continuous input data stream 
   signal = input_mask .* signal; % masking input data

for i = 2:No_of_recurrent
    [NL_signal,NL_signal_f] = NonLinearEffect(signal,soliton_order,fiber_length); %Non Linear Node effect on input data genrating reservoir state i
    NL_signal_f =  NL_signal_f .*(sqrt(2*pi)/(fft_point*delta_tau));
    readout_t(i-1,:) = abs(NL_signal).^2; 
    readout_f(i-1,:) = abs(NL_signal_f).^2; 
    
    signal = u_n(i) .* u_t_guassian;  %continuous input data stream 
    signal = input_mask .* signal; %figure; plot(Normalize_tau,signal); % masking input data
    signal = signal + NL_signal; %   
end
    [NL_signal,NL_signal_f] = NonLinearEffect(signal,soliton_order,fiber_length); %Non Linear Node effect on input data genrating reservoir state i
    NL_signal_f =  NL_signal_f .*(sqrt(2*pi)/(fft_point*delta_tau));
    readout_t(No_of_recurrent,:) = abs(NL_signal).^2; 
    readout_f(No_of_recurrent,:) = abs(NL_signal_f).^2;